- type: replace
  path: /variables/-
  value:
    name: capi_internal_ca
    type: certificate
    options:
      is_ca: true
      common_name: internalCA

- type: replace
  path: /variables/-
  value:
    name: forwarder_api_tls
    type: certificate
    options:
      ca: capi_internal_ca
      common_name: forwarder
			extended_key_usage:
			- client_auth
			- server_auth

- type: replace
  path: /variables/-
  value:
    name: forwarder_ca
    type: certificate
    options:
      common_name: forwarderCA
			is_ca: true

- type: replace
  path: /variables/-
  value:
    name: forwarder_agent
    type: certificate
    options:
      ca: forwarder_ca
      common_name: forwarder_agent
			extended_key_usage:
			- client_auth
			- server_auth

- type: replace
  path: /addons/-
  value:
    name: forwarder_agent
    include:
      stemcell:
      - os: ubuntu-xenial
    jobs:
    - name: loggr-forwarder-agent
      release: loggregator-agent
      properties:
        tls:
          ca_cert: "((forwarder_agent.ca))"
          cert: "((forwarder_agent.certificate))"
          key: "((forwarder_agent.private_key))"
        api:
          tls:
            ca_cert: "((capi_internal_ca.certificate))"
            cert: "((forwarder_api_tls.certificate))"
            key: "((forwarder_api_tls.private_key))"
            cn: "internalCA"

- type: replace
  path: /addons/-
  value:
    name: udp_forwarder
    include:
      stemcell:
      - os: ubuntu-xenial
    jobs:
    - name: loggr-udp-forwarder
      release: loggregator-agent
      properties:
        loggregator:
          tls:
            ca: "((loggregator_ca.certificate))"
            cert: "(loggregator_tls_agent.certificate))"
            key: "((loggregator_tls_agent.private_key))"

